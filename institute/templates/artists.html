<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Artworks by Artists</title>
  <link rel="stylesheet" href="../static/artists.css">
</head>
<body>
  <div id="sidebar">
    <h2>Artists</h2>
    <div id="artistLinks">
      <!-- Artist links will be displayed here -->
    </div>
  </div>
  <div id="artworksContainer">
    <!-- Artworks will be displayed here -->
  </div>
  <button class="navButton left" id="prevButton">&lt;</button>
  <button class="navButton right" id="nextButton">&gt;</button>

  <script>
    function displayArtworks(artistName, artistQuery) {
      const prevButton = document.getElementById('prevButton');
      const nextButton = document.getElementById('nextButton');
      prevButton.removeEventListener('click', scrollLeftHandler);
      nextButton.removeEventListener('click', scrollRightHandler);

      const artworksContainer = document.getElementById('artworksContainer');
      artworksContainer.innerHTML = '';

      fetch(`https://api.artic.edu/api/v1/artworks/search?q=${artistQuery}&limit=20&fields=id,title,image_id`)
        .then(response => response.json())
        .then(data => {
          const artworks = data.data;
          const baseIiifUrl = 'https://www.artic.edu/iiif/2';

          artworks.forEach(artwork => {
            const imageId = artwork.image_id;
            const iiifUrl = `${baseIiifUrl}/${imageId}/full/843,/0/default.jpg`;

            // Attempt to load the image
            const imgElement = document.createElement('img');
            imgElement.classList.add('artworkImage');
            imgElement.onload = function() {
              // If the image loads successfully, create the artwork item
              const artworkItem = document.createElement('div');
              artworkItem.classList.add('artworkItem');

              // Create a heading element for the artwork title
              const titleElement = document.createElement('h3');
              titleElement.textContent = artwork.title;

              // Append the image and title to the artwork item
              artworkItem.appendChild(imgElement);
              artworkItem.appendChild(titleElement);

              // Append the artwork item to the artworks container
              artworksContainer.appendChild(artworkItem);
            };
            imgElement.onerror = function() {
              // If the image fails to load, do nothing (skip over this artwork)
            };
            imgElement.src = iiifUrl;
          });

          artworksContainer.scrollLeft = 0;

          prevButton.addEventListener('click', scrollLeftHandler);
          nextButton.addEventListener('click', scrollRightHandler);
        })
        .catch(error => {
          console.error('Error retrieving artwork data:', error);
        });
    }

    function scrollLeftHandler() {
      const artworksContainer = document.getElementById('artworksContainer');
      artworksContainer.scrollBy(-window.innerWidth, 0);
    }

    function scrollRightHandler() {
      const artworksContainer = document.getElementById('artworksContainer');
      artworksContainer.scrollBy(window.innerWidth, 0);
    }

    fetch('https://api.artic.edu/api/v1/artists')
      .then(response => response.json())
      .then(data => {
        const artists = data.data;
        const artistLinks = document.getElementById('artistLinks');
        artists.forEach(artist => {
          const artistLink = document.createElement('a');
          artistLink.href = '#';
          artistLink.classList.add('artistLink');
          artistLink.textContent = artist.title;
          artistLink.addEventListener('click', function(event) {
            event.preventDefault();
            displayArtworks(artist.title, artist.title);
          });
          artistLinks.appendChild(artistLink);
        });
      })
      .catch(error => {
        console.error('Error retrieving artist data:', error);
      });
  </script>
</body>
</html>